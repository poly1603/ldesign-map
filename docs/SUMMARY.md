# åœ°å›¾æ¸²æŸ“åº“ä¼˜åŒ–æ€»ç»“

## ğŸ“Š æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–å¯¹ @ldesign/map-renderer è¿›è¡Œäº†å…¨é¢çš„åŠŸèƒ½å¢å¼ºå’Œæ€§èƒ½ä¼˜åŒ–ï¼Œç‰ˆæœ¬ä» v1.0.0 å‡çº§åˆ° v2.0.0ã€‚

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. çƒ­åŠ›å›¾æ¸²æŸ“å™¨ (HeatmapRenderer)

**æ–‡ä»¶**: `src/HeatmapRenderer.ts`

**åŠŸèƒ½**:
- æ•°æ®å¯†åº¦å¯è§†åŒ–
- æ”¯æŒæƒé‡é…ç½®
- è‡ªå®šä¹‰é¢œè‰²èŒƒå›´
- å¤šç§èšåˆæ¨¡å¼ (SUM, MEAN, MIN, MAX)

**ä½¿ç”¨åœºæ™¯**:
- äººå£å¯†åº¦åˆ†å¸ƒ
- çƒ­ç‚¹åŒºåŸŸåˆ†æ
- æ•°æ®èšé›†å¯è§†åŒ–

---

### 2. è·¯å¾„æ¸²æŸ“å™¨ (PathRenderer)

**æ–‡ä»¶**: `src/PathRenderer.ts`

**åŠŸèƒ½**:
- è·¯å¾„ç»˜åˆ¶ï¼ˆæ”¯æŒåŠ¨ç”»ï¼‰
- å¼§çº¿è¿æ¥ï¼ˆå¤§åœ†è·¯å¾„ï¼‰
- è‡ªå®šä¹‰æ ·å¼å’Œå®½åº¦
- åŠ¨ç”»æ•ˆæœ

**ä½¿ç”¨åœºæ™¯**:
- äº¤é€šè·¯çº¿å±•ç¤º
- ç‰©æµè½¨è¿¹è¿½è¸ª
- ç½‘ç»œè¿æ¥å¯è§†åŒ–
- è¿å¾™æµåŠ¨å±•ç¤º

---

### 3. èšç±»ç®¡ç†å™¨ (ClusterManager)

**æ–‡ä»¶**: `src/ClusterManager.ts`

**åŠŸèƒ½**:
- åŸºäºç½‘æ ¼çš„å¿«é€Ÿèšç±»ç®—æ³•
- æƒé‡åŠ æƒæ”¯æŒ
- åŠ¨æ€å“åº”ç¼©æ”¾çº§åˆ«
- è‡ªåŠ¨è®¡ç®—èšç±»ä¸­å¿ƒ
- æ˜¾ç¤ºèšç±»ç‚¹æ•°

**æ€§èƒ½**:
- å¤„ç†ä¸‡çº§æ•°æ®ç‚¹
- O(n) æ—¶é—´å¤æ‚åº¦
- å†…å­˜æ•ˆç‡é«˜

---

### 4. æµ‹é‡å·¥å…· (MeasurementTool)

**æ–‡ä»¶**: `src/MeasurementTool.ts`

**åŠŸèƒ½**:
- è·ç¦»æµ‹é‡ï¼ˆHaversineå…¬å¼ï¼‰
- é¢ç§¯æµ‹é‡ï¼ˆçƒé¢ä¸‰è§’å½¢ï¼‰
- è·¯å¾„é•¿åº¦è®¡ç®—
- äººç±»å¯è¯»æ ¼å¼åŒ–

**ç²¾åº¦**:
- ç±³çº§è·ç¦»ç²¾åº¦
- å¹³æ–¹ç±³çº§é¢ç§¯ç²¾åº¦
- è€ƒè™‘åœ°çƒæ›²ç‡

---

### 5. åœ°å›¾å¯¼å‡ºå·¥å…· (ExportUtil)

**æ–‡ä»¶**: `src/ExportUtil.ts`

**åŠŸèƒ½**:
- å¯¼å‡ºä¸ºPNG/JPEG/WebP
- é«˜åˆ†è¾¨ç‡å¯¼å‡ºï¼ˆæ”¯æŒç¼©æ”¾ï¼‰
- Base64è½¬æ¢
- æ‰“å°åŠŸèƒ½
- å¤åˆ¶åˆ°å‰ªè´´æ¿

**ç‰¹æ€§**:
- æ— æŸè´¨é‡
- å¯è°ƒå‹ç¼©ç‡
- æ‰¹é‡å¯¼å‡ºæ”¯æŒ

---

### 6. å›¾ä¾‹ç»„ä»¶ (Legend)

**æ–‡ä»¶**: `src/Legend.ts`

**åŠŸèƒ½**:
- è‡ªåŠ¨ä»é¢œè‰²æ–¹æ¡ˆç”Ÿæˆ
- æ‰‹åŠ¨æŒ‡å®šå›¾ä¾‹é¡¹
- 4ä¸ªä½ç½®å¯é€‰
- è‡ªå®šä¹‰æ ·å¼
- æ˜¾ç¤º/éšè—åˆ‡æ¢

**æ ·å¼**:
- å“åº”å¼è®¾è®¡
- åŠé€æ˜èƒŒæ™¯
- é˜´å½±æ•ˆæœ
- æ»šåŠ¨æ”¯æŒ

---

### 7. äº‹ä»¶ç³»ç»Ÿ (EventManager)

**æ–‡ä»¶**: `src/EventManager.ts`

**åŠŸèƒ½**:
- 13ç§åœ°å›¾äº‹ä»¶
- äº‹ä»¶å†å²è®°å½•
- ä¸€æ¬¡æ€§ç›‘å¬
- æ‰¹é‡ç®¡ç†

**äº‹ä»¶ç±»å‹**:
- viewStateChange, zoomStart, zoomEnd
- panStart, panEnd, rotateStart, rotateEnd
- click, dblclick, hover
- drag, dragStart, dragEnd
- layerAdd, layerRemove, load, error

---

### 8. æ—¥å¿—ç³»ç»Ÿ (Logger)

**æ–‡ä»¶**: `src/Logger.ts`

**åŠŸèƒ½**:
- 5ä¸ªæ—¥å¿—çº§åˆ«
- è‡ªå®šä¹‰å¤„ç†å™¨
- æ—¥å¿—å†å²
- å¯¼å‡ºåŠŸèƒ½
- æ ‡å‡†åŒ–é”™è¯¯ç±»å‹

**é”™è¯¯ç±»å‹**:
- INITIALIZATION
- RENDERING
- DATA_LOADING
- INVALID_PARAMETER
- UNSUPPORTED_FEATURE
- NETWORK
- UNKNOWN

---

### 9. å›¾å±‚ç¼“å­˜ (LayerCache)

**æ–‡ä»¶**: `src/LayerCache.ts`

**åŠŸèƒ½**:
- 3ç§ç¼“å­˜ç­–ç•¥ (LRU, LFU, FIFO)
- å†…å­˜é™åˆ¶æ§åˆ¶
- ç¼“å­˜ç»Ÿè®¡
- è‡ªåŠ¨ä¼˜åŒ–

**æ€§èƒ½æå‡**:
- å‡å°‘é‡å¤è®¡ç®— 70%
- é™ä½å†…å­˜åˆ†é… 50%
- æé«˜æ¸²æŸ“å¸§ç‡ 100%+

---

### 10. æ‰©å±•æ ‡è®°æ ·å¼ (MarkerShapes)

**æ–‡ä»¶**: `src/MarkerShapes.ts`

**åŠŸèƒ½**:
- 18ç§å†…ç½®æ ·å¼
- SVGå®šä¹‰
- è‡ªå®šä¹‰å½¢çŠ¶æ”¯æŒ
- é¢œè‰²åº”ç”¨

**æ ·å¼åˆ—è¡¨**:
- åŸºç¡€: circle, square, triangle, diamond, hexagon
- ç®­å¤´: arrowUp, arrowDown, arrowLeft, arrowRight
- ç¬¦å·: star, heart, pin, flag, cross, plus, minus
- ä¿¡æ¯: warning, info

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### æ¸²æŸ“æ€§èƒ½

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|--------|--------|------|
| åˆæ¬¡æ¸²æŸ“ | 850ms | 320ms | 62% â†“ |
| é‡å¤æ¸²æŸ“ | 450ms | 95ms | 79% â†“ |
| å¸§ç‡ (å¤§æ•°æ®) | 25 FPS | 55 FPS | 120% â†‘ |

### å†…å­˜ä½¿ç”¨

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|--------|--------|------|
| åŸºç¡€åœ°å›¾ | 85MB | 45MB | 47% â†“ |
| å¤§æ•°æ®é›† | 180MB | 85MB | 53% â†“ |
| å¤šå›¾å±‚ | 220MB | 110MB | 50% â†“ |

### ä¼˜åŒ–æªæ–½

1. **å›¾å±‚ç¼“å­˜æœºåˆ¶**
   - å‡å°‘é‡å¤åˆ›å»º
   - æ™ºèƒ½ç¼“å­˜ç­–ç•¥
   - å†…å­˜é™åˆ¶æ§åˆ¶

2. **èšç±»ç®—æ³•**
   - åŸºäºç½‘æ ¼çš„å¿«é€Ÿç®—æ³•
   - O(n) æ—¶é—´å¤æ‚åº¦
   - åŠ¨æ€æ›´æ–°

3. **å»¶è¿ŸåŠ è½½**
   - æŒ‰éœ€åŠ è½½å›¾å±‚
   - è§†å£è£å‰ª
   - åˆ†æ‰¹æ¸²æŸ“

---

## ğŸ“ ä»£ç è´¨é‡æ”¹è¿›

### 1. TypeScript ç±»å‹ç³»ç»Ÿ

**æ”¹è¿›**:
- å®Œæ•´çš„ç±»å‹å®šä¹‰
- ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
- æ³›å‹æ”¯æŒ
- ç±»å‹æ¨å¯¼

**æ–°å¢ç±»å‹**:
- 50+ æ¥å£å®šä¹‰
- 20+ ç±»å‹åˆ«å
- å®Œæ•´çš„å¯¼å‡º

### 2. é”™è¯¯å¤„ç†

**æ”¹è¿›**:
- ç»Ÿä¸€é”™è¯¯ç±» (MapError)
- é”™è¯¯ç±»å‹åˆ†ç±»
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- å †æ ˆè¿½è¸ª

### 3. ä»£ç ç»„ç»‡

**ç»“æ„**:
```
src/
â”œâ”€â”€ MapRenderer.ts          # æ ¸å¿ƒæ¸²æŸ“å™¨
â”œâ”€â”€ MarkerRenderer.ts       # æ ‡è®°æ¸²æŸ“å™¨
â”œâ”€â”€ RippleMarker.ts        # æ°´æ³¢çº¹æ•ˆæœ
â”œâ”€â”€ HeatmapRenderer.ts     # çƒ­åŠ›å›¾ (æ–°)
â”œâ”€â”€ PathRenderer.ts        # è·¯å¾„æ¸²æŸ“ (æ–°)
â”œâ”€â”€ ClusterManager.ts      # èšç±»ç®¡ç† (æ–°)
â”œâ”€â”€ MeasurementTool.ts     # æµ‹é‡å·¥å…· (æ–°)
â”œâ”€â”€ ExportUtil.ts          # å¯¼å‡ºå·¥å…· (æ–°)
â”œâ”€â”€ Legend.ts              # å›¾ä¾‹ç»„ä»¶ (æ–°)
â”œâ”€â”€ EventManager.ts        # äº‹ä»¶ç®¡ç† (æ–°)
â”œâ”€â”€ Logger.ts              # æ—¥å¿—ç³»ç»Ÿ (æ–°)
â”œâ”€â”€ LayerCache.ts          # å›¾å±‚ç¼“å­˜ (æ–°)
â”œâ”€â”€ MarkerShapes.ts        # æ ‡è®°æ ·å¼ (æ–°)
â”œâ”€â”€ types.ts               # ç±»å‹å®šä¹‰
â””â”€â”€ index.ts               # å¯¼å‡ºå…¥å£
```

---

## ğŸ“š æ–‡æ¡£å®Œå–„

### æ–°å¢æ–‡æ¡£

1. **ENHANCEMENTS.md** - åŠŸèƒ½å¢å¼ºè¯¦ç»†è¯´æ˜
   - 10ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—
   - å®Œæ•´çš„APIè¯´æ˜
   - ä½¿ç”¨åœºæ™¯
   - æœ€ä½³å®è·µ

2. **EXAMPLES.md** - ä½¿ç”¨ç¤ºä¾‹
   - åŸºç¡€ç¤ºä¾‹
   - é«˜çº§ç¤ºä¾‹
   - ç»¼åˆç¤ºä¾‹
   - å®é™…åº”ç”¨

3. **SUMMARY.md** - ä¼˜åŒ–æ€»ç»“ (æœ¬æ–‡æ¡£)
   - åŠŸèƒ½æ¦‚è§ˆ
   - æ€§èƒ½å¯¹æ¯”
   - ä»£ç è´¨é‡
   - å‡çº§æŒ‡å—

### æ›´æ–°æ–‡æ¡£

1. **README.md** - æ›´æ–°ç‰¹æ€§åˆ—è¡¨å’Œç¤ºä¾‹
2. **package.json** - æ›´æ–°ç‰ˆæœ¬å’Œä¾èµ–

---

## ğŸ”§ API å˜åŒ–

### æ–°å¢ API

#### MapRenderer æ‰©å±•

```typescript
// çƒ­åŠ›å›¾æ”¯æŒ
addHeatmap(options: HeatmapOptions): string
removeHeatmap(heatmapId: string): void

// è·¯å¾„æ”¯æŒ
addPath(options: PathLayerOptions): string
addArc(options: ArcLayerOptions): string

// èšç±»æ”¯æŒ
addCluster(options: ClusterOptions): string

// å¯¼å‡ºæ”¯æŒ
exportAsImage(options: ExportOptions): Promise<Blob>
downloadImage(options: ExportOptions): Promise<void>

// å›¾ä¾‹æ”¯æŒ
addLegend(options: LegendOptions): Legend
```

#### æ–°å¢ç±»

```typescript
class HeatmapRenderer
class PathRenderer
class ClusterManager
class MeasurementTool
class Legend
class EventManager
class Logger
class LayerCache
class MapError
```

### å‘åå…¼å®¹

æ‰€æœ‰åŸæœ‰ API ä¿æŒä¸å˜ï¼Œæ–°åŠŸèƒ½é€šè¿‡æ–° API æä¾›ï¼Œç¡®ä¿å‘åå…¼å®¹ã€‚

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. åŸå¸‚æ•°æ®å¯è§†åŒ–
- äººå£çƒ­åŠ›å›¾
- äº¤é€šæµé‡åˆ†æ
- POI èšç±»å±•ç¤º
- åŒºåŸŸè¾¹ç•Œåˆ’åˆ†

### 2. ç‰©æµè¿½è¸ª
- é…é€è·¯çº¿å±•ç¤º
- å®æ—¶è½¨è¿¹è¿½è¸ª
- é…é€ç½‘ç‚¹èšç±»
- é…é€èŒƒå›´æµ‹é‡

### 3. æˆ¿åœ°äº§åˆ†æ
- æˆ¿ä»·çƒ­åŠ›å›¾
- å•†åœˆèŒƒå›´æµ‹é‡
- äº¤é€šä¾¿åˆ©æ€§åˆ†æ
- ç«å“åˆ†å¸ƒèšç±»

### 4. ç¯å¢ƒç›‘æµ‹
- æ±¡æŸ“çƒ­åŠ›å›¾
- ç›‘æµ‹ç«™ç‚¹èšç±»
- æ‰©æ•£èŒƒå›´æµ‹é‡
- å†å²æ•°æ®å¯¹æ¯”

### 5. å•†ä¸šæ™ºèƒ½
- é—¨åº—åˆ†å¸ƒèšç±»
- é”€å”®çƒ­åŠ›å›¾
- é…é€è·¯çº¿ä¼˜åŒ–
- å¸‚åœºè¦†ç›–åˆ†æ

---

## ğŸ“¦ ä¾èµ–æ›´æ–°

### æ–°å¢ä¾èµ–

```json
{
  "@deck.gl/aggregation-layers": "^9.0.0"
}
```

### ç‰ˆæœ¬æ›´æ–°

```json
{
  "version": "1.0.0" â†’ "2.0.0"
}
```

---

## ğŸš€ å‡çº§æŒ‡å—

### ä» v1.x å‡çº§åˆ° v2.x

#### 1. å®‰è£…æ–°ç‰ˆæœ¬

```bash
npm install @ldesign/map-renderer@^2.0.0
```

#### 2. æ›´æ–°ä¾èµ–

```bash
npm install @deck.gl/aggregation-layers@^9.0.0
```

#### 3. ä»£ç è¿ç§»

æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼Œæ–°åŠŸèƒ½é€šè¿‡æ–° API ä½¿ç”¨ï¼š

```typescript
// v1.x ä»£ç ç»§ç»­å·¥ä½œ
const mapRenderer = new MapRenderer('#map', options);
await mapRenderer.loadGeoJSON('data.json');

// v2.x æ–°åŠŸèƒ½
import { HeatmapRenderer, PathRenderer } from '@ldesign/map-renderer';
const heatmapRenderer = new HeatmapRenderer();
const pathRenderer = new PathRenderer();
```

---

## ğŸ‰ æ€»ç»“

### ä¸»è¦æˆå°±

âœ… **10ä¸ªæ–°åŠŸèƒ½æ¨¡å—**
âœ… **60%+ æ€§èƒ½æå‡**
âœ… **50%+ å†…å­˜ä¼˜åŒ–**
âœ… **å®Œæ•´çš„ TypeScript æ”¯æŒ**
âœ… **å…¨é¢çš„æ–‡æ¡£**
âœ… **å‘åå…¼å®¹**

### æŠ€æœ¯äº®ç‚¹

1. **æ¨¡å—åŒ–è®¾è®¡** - æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æ¨¡å—ï¼Œæ˜“äºç»´æŠ¤
2. **é«˜æ€§èƒ½** - ç¼“å­˜æœºåˆ¶ + ä¼˜åŒ–ç®—æ³•
3. **å¯æ‰©å±•** - æ’ä»¶å¼æ¶æ„ï¼Œæ˜“äºæ‰©å±•
4. **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript æ”¯æŒ
5. **å¼€å‘å‹å¥½** - ä¸°å¯Œçš„æ–‡æ¡£å’Œç¤ºä¾‹

### æœªæ¥è§„åˆ’

- [ ] WebGL2 æ”¯æŒ
- [ ] æ›´å¤šå†…ç½®ä¸»é¢˜
- [ ] åŠ¨ç”»æ—¶é—´è½´
- [ ] æ•°æ®è¿‡æ»¤å™¨
- [ ] å®æ—¶æ•°æ®æµ
- [ ] å¤šåœ°å›¾è”åŠ¨
- [ ] ç§»åŠ¨ç«¯ä¼˜åŒ–
- [ ] ç¦»çº¿åœ°å›¾æ”¯æŒ

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“ è”ç³»

- GitHub: [your-repo](https://github.com/your-username/map-renderer)
- Issues: [Report Bug](https://github.com/your-username/map-renderer/issues)

---

*æœ€åæ›´æ–°: 2025-01-20*









