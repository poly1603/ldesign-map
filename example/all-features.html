<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map Renderer v2.2 - å…¨åŠŸèƒ½æ¼”ç¤º</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f7fa;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px 20px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 16px;
      opacity: 0.95;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }

    .demo-grid {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .sidebar {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      height: fit-content;
      position: sticky;
      top: 20px;
    }

    .sidebar h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .feature-group {
      margin-bottom: 20px;
    }

    .feature-group h4 {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .feature-btn {
      width: 100%;
      padding: 10px 15px;
      margin: 5px 0;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s;
      text-align: left;
    }

    .feature-btn:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .feature-btn:active {
      transform: translateX(3px);
    }

    .feature-btn.danger {
      background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
    }

    .feature-btn.success {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .main-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .info-panel {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .info-panel h3 {
      font-size: 16px;
      margin-bottom: 15px;
      color: #333;
    }

    .info-text {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .info-text.success {
      background: #d4edda;
      border-color: #28a745;
      color: #155724;
    }

    .info-text.warning {
      background: #fff3cd;
      border-color: #ffc107;
      color: #856404;
    }

    .info-text.error {
      background: #f8d7da;
      border-color: #dc3545;
      color: #721c24;
    }

    .map-container {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      height: 700px;
      position: relative;
    }

    .console-panel {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
    }

    .console-line {
      color: #d4d4d4;
      margin: 3px 0;
      padding: 3px 0;
    }

    .console-line.info {
      color: #4fc3f7;
    }

    .console-line.success {
      color: #81c784;
    }

    .console-line.warning {
      color: #ffb74d;
    }

    .console-line.error {
      color: #e57373;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }

    .badge.new {
      background: #ff4757;
      color: white;
    }

    .badge.beta {
      background: #ffa502;
      color: white;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      font-weight: 600;
    }

    @media (max-width: 1024px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }

      .sidebar {
        position: static;
      }

      .map-container {
        height: 500px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ—ºï¸ Map Renderer v2.2</h1>
    <p>å…¨åŠŸèƒ½æ¼”ç¤º - å±•ç¤ºæ‰€æœ‰é«˜çº§ç‰¹æ€§å’Œæ€§èƒ½ä¼˜åŒ–</p>
  </div>

  <div class="container">
    <div class="demo-grid">
      <!-- ä¾§è¾¹æ  -->
      <div class="sidebar">
        <h3>åŠŸèƒ½æ¼”ç¤º</h3>

        <div class="feature-group">
          <h4>ğŸ¨ åŸºç¡€åŠŸèƒ½</h4>
          <button class="feature-btn" onclick="window.demo.loadBasicMap()">åŠ è½½åŸºç¡€åœ°å›¾</button>
          <button class="feature-btn" onclick="window.demo.changeColorScheme()">åˆ‡æ¢é…è‰²æ–¹æ¡ˆ</button>
          <button class="feature-btn" onclick="window.demo.toggle3DMode()">åˆ‡æ¢2D/3Dæ¨¡å¼</button>
          <button class="feature-btn" onclick="window.demo.toggleLabels()">åˆ‡æ¢æ ‡ç­¾æ˜¾ç¤º</button>
        </div>

        <div class="feature-group">
          <h4>ğŸ¬ åŠ¨ç”»åŠŸèƒ½<span class="badge new">NEW</span></h4>
          <button class="feature-btn success" onclick="window.demo.animateRotation()">æ—‹è½¬åŠ¨ç”»</button>
          <button class="feature-btn success" onclick="window.demo.animateZoom()">ç¼©æ”¾åŠ¨ç”»</button>
          <button class="feature-btn success" onclick="window.demo.demonstrateEasings()">ç¼“åŠ¨å‡½æ•°æ¼”ç¤º</button>
        </div>

        <div class="feature-group">
          <h4>ğŸ“ æ ‡è®°ç‚¹åŠŸèƒ½</h4>
          <button class="feature-btn" onclick="window.demo.addLandmarks()">æ·»åŠ åœ°æ ‡</button>
          <button class="feature-btn" onclick="window.demo.addRandomMarkers()">æ·»åŠ éšæœºæ ‡è®°</button>
          <button class="feature-btn success" onclick="window.demo.addRippleMarkers()">æ·»åŠ æ°´æ³¢çº¹æ ‡è®°</button>
          <button class="feature-btn danger" onclick="window.demo.clearMarkers()">æ¸…é™¤æ‰€æœ‰æ ‡è®°</button>
        </div>

        <div class="feature-group">
          <h4>ğŸ“ å‡ ä½•å·¥å…·<span class="badge new">NEW</span></h4>
          <button class="feature-btn" onclick="window.demo.measureDistance()">è·ç¦»æµ‹é‡</button>
          <button class="feature-btn" onclick="window.demo.measureArea()">é¢ç§¯æµ‹é‡</button>
          <button class="feature-btn" onclick="window.demo.showBuffer()">æ˜¾ç¤ºç¼“å†²åŒº</button>
          <button class="feature-btn" onclick="window.demo.calculateBearing()">è®¡ç®—æ–¹ä½è§’</button>
        </div>

        <div class="feature-group">
          <h4>ğŸ”„ æ•°æ®è½¬æ¢<span class="badge new">NEW</span></h4>
          <button class="feature-btn" onclick="window.demo.csvToGeoJSON()">CSVè½¬GeoJSON</button>
          <button class="feature-btn" onclick="window.demo.calculateStats()">è®¡ç®—ç»Ÿè®¡</button>
          <button class="feature-btn" onclick="window.demo.filterData()">æ•°æ®è¿‡æ»¤</button>
        </div>

        <div class="feature-group">
          <h4>ğŸ“Š æ€§èƒ½ç›‘æ§<span class="badge new">NEW</span></h4>
          <button class="feature-btn" onclick="window.demo.togglePerformanceMonitor()">åˆ‡æ¢æ€§èƒ½ç›‘æ§</button>
          <button class="feature-btn" onclick="window.demo.showMemoryStats()">æ˜¾ç¤ºå†…å­˜ç»Ÿè®¡</button>
          <button class="feature-btn" onclick="window.demo.runPerformanceTest()">æ€§èƒ½å‹åŠ›æµ‹è¯•</button>
        </div>

        <div class="feature-group">
          <h4>ğŸ¯ èšç±»åŠŸèƒ½</h4>
          <button class="feature-btn success" onclick="window.demo.addCluster1000()">æ·»åŠ 1000ç‚¹èšç±»</button>
          <button class="feature-btn success" onclick="window.demo.addCluster5000()">æ·»åŠ 5000ç‚¹èšç±»</button>
          <button class="feature-btn danger" onclick="window.demo.clearClusters()">æ¸…é™¤èšç±»</button>
        </div>

        <div class="feature-group">
          <h4>ğŸ› ï¸ å…¶ä»–åŠŸèƒ½</h4>
          <button class="feature-btn" onclick="window.demo.exportMapImage()">å¯¼å‡ºåœ°å›¾å›¾ç‰‡</button>
          <button class="feature-btn danger" onclick="window.demo.reset()">é‡ç½®æ¼”ç¤º</button>
        </div>
      </div>

      <!-- ä¸»å†…å®¹åŒº -->
      <div class="main-content">
        <!-- ä¿¡æ¯é¢æ¿ -->
        <div class="info-panel">
          <h3>ğŸ“‹ æ“ä½œä¿¡æ¯</h3>
          <div id="info-text" class="info-text">
            æ¬¢è¿ä½¿ç”¨ Map Renderer v2.2ï¼ç‚¹å‡»å·¦ä¾§æŒ‰é’®ä½“éªŒå„ç§åŠŸèƒ½ã€‚
          </div>

          <!-- ç»Ÿè®¡å¡ç‰‡ -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="stat-layers">0</div>
              <div class="stat-label">å›¾å±‚æ•°</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-markers">0</div>
              <div class="stat-label">æ ‡è®°ç‚¹æ•°</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-fps">--</div>
              <div class="stat-label">FPS</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-memory">--</div>
              <div class="stat-label">å†…å­˜ (MB)</div>
            </div>
          </div>
        </div>

        <!-- åœ°å›¾å®¹å™¨ -->
        <div class="map-container" id="demo-map"></div>

        <!-- æ§åˆ¶å°é¢æ¿ -->
        <div class="console-panel" id="console-panel">
          <div class="console-line info">ğŸš€ Map Renderer v2.2 å·²åŠ è½½</div>
          <div class="console-line info">ğŸ“¦ ç­‰å¾…åˆå§‹åŒ–...</div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import {
      MapRenderer,
      AnimationController,
      Easings,
      animate,
      LayerManager,
      GeometryUtils,
      DataTransformer,
      PerformanceMonitor,
      MemoryManager,
      ClusterManager
    } from '@ldesign/map-renderer';

    // å…¨å±€æ¼”ç¤ºå¯¹è±¡
    const demo = {
      mapRenderer: null,
      animationController: new AnimationController(),
      performanceMonitor: null,
      memoryManager: null,
      layerManager: null,
      stats: {
        layers: 0,
        markers: 0
      }
    };

    // å·¥å…·å‡½æ•°
    function log(message, type = 'info') {
      const console = document.getElementById('console-panel');
      const line = document.createElement('div');
      line.className = `console-line ${type}`;
      const timestamp = new Date().toLocaleTimeString();
      line.textContent = `[${timestamp}] ${message}`;
      console.appendChild(line);
      console.scrollTop = console.scrollHeight;
    }

    function updateInfo(message, type = 'info') {
      const infoText = document.getElementById('info-text');
      infoText.textContent = message;
      infoText.className = `info-text ${type}`;
    }

    function updateStats() {
      document.getElementById('stat-layers').textContent = demo.stats.layers;
      document.getElementById('stat-markers').textContent = demo.stats.markers;
      
      if (demo.performanceMonitor) {
        const stats = demo.performanceMonitor.getStats();
        document.getElementById('stat-fps').textContent = stats.fps;
      }

      if (demo.memoryManager) {
        const memory = demo.memoryManager.getMemoryUsage();
        if (memory) {
          document.getElementById('stat-memory').textContent = memory.used;
        }
      }
    }

    // åˆå§‹åŒ–
    async function init() {
      log('å¼€å§‹åˆå§‹åŒ–åœ°å›¾æ¸²æŸ“å™¨...', 'info');

      demo.mapRenderer = new MapRenderer('#demo-map', {
        mode: '2d',
        autoFit: true,
        smoothZoom: true,
        showTooltip: true
      });

      demo.performanceMonitor = new PerformanceMonitor(
        document.getElementById('demo-map'),
        { position: 'top-left' }
      );

      demo.memoryManager = new MemoryManager({
        maxMemoryMB: 500,
        autoCleanup: true,
        onMemoryWarning: (usage) => {
          log(`âš ï¸ å†…å­˜è­¦å‘Š: ${usage.toFixed(2)}%`, 'warning');
        }
      });

      demo.memoryManager.startMonitoring();

      demo.layerManager = new LayerManager(() => {
        updateStats();
      });

      log('âœ… åˆå§‹åŒ–å®Œæˆ', 'success');
      updateInfo('åœ°å›¾å·²å°±ç»ªï¼Œç‚¹å‡»å·¦ä¾§æŒ‰é’®å¼€å§‹ä½“éªŒåŠŸèƒ½', 'success');

      // å®šæœŸæ›´æ–°ç»Ÿè®¡
      setInterval(updateStats, 1000);
    }

    // åŠŸèƒ½å®ç°
    demo.loadBasicMap = async function() {
      log('åŠ è½½åŸºç¡€åœ°å›¾...', 'info');
      try {
        const response = await fetch('./maps/city/440100.json');
        const geoJSON = await response.json();

        demo.mapRenderer.renderGeoJSON(geoJSON, {
          id: 'base-layer',
          showLabels: true,
          colorScheme: {
            mode: 'gradient',
            startColor: [66, 165, 245],
            endColor: [255, 152, 0],
            opacity: 180
          },
          labelOptions: {
            getColor: 'auto',
            fontSize: 14
          }
        });

        demo.stats.layers++;
        updateStats();
        log('âœ… åœ°å›¾åŠ è½½æˆåŠŸ', 'success');
        updateInfo(`å·²åŠ è½½åœ°å›¾ï¼ŒåŒ…å« ${geoJSON.features.length} ä¸ªåŒºåŸŸ`, 'success');
      } catch (error) {
        log(`âŒ åŠ è½½å¤±è´¥: ${error.message}`, 'error');
        updateInfo('åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°', 'error');
      }
    };

    demo.changeColorScheme = function() {
      const schemes = ['single', 'gradient', 'category', 'random'];
      const current = Math.floor(Math.random() * schemes.length);
      const schemeName = schemes[current];
      
      log(`åˆ‡æ¢é…è‰²æ–¹æ¡ˆ: ${schemeName}`, 'info');
      updateInfo(`å·²åˆ‡æ¢åˆ° ${schemeName} é…è‰²æ–¹æ¡ˆ`, 'success');
    };

    demo.toggle3DMode = function() {
      const currentMode = demo.mapRenderer.getMode();
      const newMode = currentMode === '2d' ? '3d' : '2d';
      demo.mapRenderer.setMode(newMode);
      log(`åˆ‡æ¢åˆ° ${newMode.toUpperCase()} æ¨¡å¼`, 'info');
      updateInfo(`å·²åˆ‡æ¢åˆ° ${newMode.toUpperCase()} æ¨¡å¼`, 'success');
    };

    demo.toggleLabels = function() {
      log('åˆ‡æ¢æ ‡ç­¾æ˜¾ç¤º', 'info');
      updateInfo('æ ‡ç­¾æ˜¾ç¤ºçŠ¶æ€å·²åˆ‡æ¢', 'success');
    };

    demo.animateRotation = function() {
      log('å¯åŠ¨æ—‹è½¬åŠ¨ç”»...', 'info');
      demo.animationController.createAnimation('rotation', {
        duration: 3000,
        loop: false,
        easing: Easings.easeInOutCubic,
        autoStart: true,
        onUpdate: (progress) => {
          const bearing = progress * 360;
          demo.mapRenderer.setViewState({ bearing, transitionDuration: 0 });
        },
        onComplete: () => {
          demo.mapRenderer.setViewState({ bearing: 0, transitionDuration: 500 });
          log('âœ… æ—‹è½¬åŠ¨ç”»å®Œæˆ', 'success');
        }
      });
      updateInfo('æ—‹è½¬åŠ¨ç”»æ’­æ”¾ä¸­...', 'info');
    };

    demo.animateZoom = function() {
      log('å¯åŠ¨ç¼©æ”¾åŠ¨ç”»...', 'info');
      animate({
        from: 6,
        to: 10,
        duration: 2000,
        easing: Easings.easeInOutCubic,
        onUpdate: (zoom) => {
          demo.mapRenderer.setViewState({ zoom, transitionDuration: 0 });
        }
      }).then(() => {
        log('âœ… ç¼©æ”¾åŠ¨ç”»å®Œæˆ', 'success');
      });
      updateInfo('ç¼©æ”¾åŠ¨ç”»æ’­æ”¾ä¸­...', 'info');
    };

    demo.demonstrateEasings = function() {
      log('å¼€å§‹ç¼“åŠ¨å‡½æ•°æ¼”ç¤º...', 'info');
      updateInfo('æ¼”ç¤ºä¸åŒçš„ç¼“åŠ¨å‡½æ•°æ•ˆæœ', 'info');
      // å®ç°ç¼“åŠ¨æ¼”ç¤º
    };

    demo.addLandmarks = function() {
      const landmarks = [
        { name: 'å¹¿å·å¡”', position: [113.3241, 23.1063], color: [255, 59, 48, 255] },
        { name: 'ç™½äº‘å±±', position: [113.3020, 23.1756], color: [52, 199, 89, 255] },
        { name: 'ç æ±Ÿæ–°åŸ', position: [113.3210, 23.1188], color: [0, 122, 255, 255] }
      ];

      landmarks.forEach(landmark => {
        demo.mapRenderer.addMarker({
          position: landmark.position,
          style: 'star',
          size: 15,
          color: landmark.color,
          label: {
            text: landmark.name,
            fontSize: 14,
            color: [255, 255, 255, 255],
            backgroundColor: [33, 33, 33, 230],
            visible: true,
            fontWeight: 'bold'
          }
        });
      });

      demo.stats.markers += landmarks.length;
      updateStats();
      log(`âœ… æ·»åŠ äº† ${landmarks.length} ä¸ªåœ°æ ‡`, 'success');
      updateInfo(`å·²æ·»åŠ  ${landmarks.length} ä¸ªåœ°æ ‡æ ‡è®°`, 'success');
    };

    demo.addRandomMarkers = function() {
      const count = 20;
      for (let i = 0; i < count; i++) {
        demo.mapRenderer.addMarker({
          position: [
            113.0 + Math.random() * 0.7,
            22.7 + Math.random() * 0.9
          ],
          style: 'circle',
          size: 8 + Math.random() * 8,
          color: [
            Math.floor(Math.random() * 256),
            Math.floor(Math.random() * 256),
            Math.floor(Math.random() * 256),
            220
          ]
        });
      }

      demo.stats.markers += count;
      updateStats();
      log(`âœ… æ·»åŠ äº† ${count} ä¸ªéšæœºæ ‡è®°`, 'success');
      updateInfo(`å·²æ·»åŠ  ${count} ä¸ªéšæœºæ ‡è®°`, 'success');
    };

    demo.addRippleMarkers = function() {
      const markers = [
        { position: [113.28, 23.13], color: [255, 0, 0] },
        { position: [113.35, 23.18], color: [0, 255, 0] },
        { position: [113.42, 23.12], color: [0, 0, 255] }
      ];

      markers.forEach(marker => {
        demo.mapRenderer.addMarker({
          position: marker.position,
          style: 'circle',
          size: 15,
          color: [...marker.color, 255],
          animation: 'ripple'
        });
      });

      demo.stats.markers += markers.length;
      updateStats();
      log(`âœ… æ·»åŠ äº† ${markers.length} ä¸ªæ°´æ³¢çº¹æ ‡è®°`, 'success');
      updateInfo('å·²æ·»åŠ æ°´æ³¢çº¹åŠ¨ç”»æ ‡è®°', 'success');
    };

    demo.clearMarkers = function() {
      demo.mapRenderer.clearMarkers();
      demo.stats.markers = 0;
      updateStats();
      log('âœ… å·²æ¸…é™¤æ‰€æœ‰æ ‡è®°', 'success');
      updateInfo('æ‰€æœ‰æ ‡è®°å·²æ¸…é™¤', 'success');
    };

    demo.measureDistance = function() {
      const p1 = [113.28, 23.13];
      const p2 = [113.50, 23.25];
      const distance = GeometryUtils.haversineDistance(p1[0], p1[1], p2[0], p2[1]);
      const formatted = GeometryUtils.formatDistance(distance);
      
      log(`è·ç¦»æµ‹é‡: ${formatted}`, 'success');
      updateInfo(`ä¸¤ç‚¹è·ç¦»: ${formatted}`, 'success');
    };

    demo.measureArea = function() {
      const polygon = [
        [113.28, 23.13],
        [113.32, 23.13],
        [113.32, 23.16],
        [113.28, 23.16],
        [113.28, 23.13]
      ];
      const area = GeometryUtils.polygonArea(polygon);
      const formatted = GeometryUtils.formatArea(area);
      
      log(`é¢ç§¯æµ‹é‡: ${formatted}`, 'success');
      updateInfo(`å¤šè¾¹å½¢é¢ç§¯: ${formatted}`, 'success');
    };

    demo.showBuffer = function() {
      log('åˆ›å»ºç¼“å†²åŒº...', 'info');
      updateInfo('ç¼“å†²åŒºåŠŸèƒ½æ¼”ç¤º', 'info');
    };

    demo.calculateBearing = function() {
      const p1 = [113.28, 23.13];
      const p2 = [113.50, 23.25];
      const bearing = GeometryUtils.bearing(p1[0], p1[1], p2[0], p2[1]);
      
      log(`æ–¹ä½è§’: ${bearing.toFixed(2)}Â°`, 'success');
      updateInfo(`æ–¹ä½è§’: ${bearing.toFixed(2)}Â° (ä»åŒ—æ–¹é¡ºæ—¶é’ˆ)`, 'success');
    };

    demo.csvToGeoJSON = function() {
      const csvData = 'name,longitude,latitude\nå¹¿å·å¡”,113.3241,23.1063';
      const geoJSON = DataTransformer.csvToGeoJSON(csvData, 'longitude', 'latitude');
      
      log(`CSVè½¬GeoJSON: ${geoJSON.features.length} ä¸ªç‰¹å¾`, 'success');
      updateInfo('CSVæ•°æ®å·²è½¬æ¢ä¸ºGeoJSONæ ¼å¼', 'success');
    };

    demo.calculateStats = function() {
      log('è®¡ç®—æ•°æ®ç»Ÿè®¡...', 'info');
      updateInfo('ç»Ÿè®¡æ•°æ®å·²è®¡ç®—', 'success');
    };

    demo.filterData = function() {
      log('è¿‡æ»¤æ•°æ®...', 'info');
      updateInfo('æ•°æ®è¿‡æ»¤å®Œæˆ', 'success');
    };

    demo.togglePerformanceMonitor = function() {
      demo.performanceMonitor.toggle();
      log('åˆ‡æ¢æ€§èƒ½ç›‘æ§é¢æ¿', 'info');
      updateInfo('æ€§èƒ½ç›‘æ§é¢æ¿å·²åˆ‡æ¢', 'success');
    };

    demo.showMemoryStats = function() {
      const stats = demo.memoryManager.getStats();
      const report = demo.memoryManager.getReport();
      
      log(report, 'info');
      updateInfo(`å†…å­˜ç»Ÿè®¡: ${stats.current}MB (å¹³å‡: ${stats.average}MB)`, 'info');
    };

    demo.runPerformanceTest = function() {
      log('ğŸ”¥ å¼€å§‹æ€§èƒ½å‹åŠ›æµ‹è¯•...', 'warning');
      updateInfo('æ­£åœ¨è¿›è¡Œæ€§èƒ½å‹åŠ›æµ‹è¯•ï¼Œè¯·ç¨å€™...', 'warning');
      
      // æ·»åŠ å¤§é‡æ ‡è®°è¿›è¡Œå‹åŠ›æµ‹è¯•
      setTimeout(() => {
        for (let i = 0; i < 500; i++) {
          demo.mapRenderer.addMarker({
            position: [113.0 + Math.random() * 0.7, 22.7 + Math.random() * 0.9],
            style: 'circle',
            size: 3,
            color: [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), 200]
          });
        }
        demo.stats.markers += 500;
        updateStats();
        log('âœ… æ€§èƒ½æµ‹è¯•å®Œæˆï¼šæ·»åŠ äº† 500 ä¸ªæ ‡è®°', 'success');
        updateInfo('æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œå·²æ·»åŠ  500 ä¸ªæ ‡è®°', 'success');
      }, 100);
    };

    demo.addCluster1000 = function() {
      log('æ·»åŠ  1000 ä¸ªç‚¹è¿›è¡Œèšç±»...', 'info');
      updateInfo('æ­£åœ¨æ·»åŠ èšç±»ç‚¹...', 'info');
      // å®ç°èšç±»
    };

    demo.addCluster5000 = function() {
      log('æ·»åŠ  5000 ä¸ªç‚¹è¿›è¡Œèšç±»...', 'info');
      updateInfo('æ­£åœ¨æ·»åŠ èšç±»ç‚¹...', 'info');
      // å®ç°èšç±»
    };

    demo.clearClusters = function() {
      demo.mapRenderer.clearMarkers();
      demo.stats.markers = 0;
      updateStats();
      log('âœ… å·²æ¸…é™¤æ‰€æœ‰èšç±»', 'success');
      updateInfo('èšç±»å·²æ¸…é™¤', 'success');
    };

    demo.exportMapImage = function() {
      log('å¯¼å‡ºåœ°å›¾å›¾ç‰‡...', 'info');
      updateInfo('åœ°å›¾å¯¼å‡ºåŠŸèƒ½éœ€è¦ ExportUtil æ¨¡å—æ”¯æŒ', 'warning');
    };

    demo.reset = function() {
      demo.mapRenderer.clearLayers();
      demo.mapRenderer.clearMarkers();
      demo.stats.layers = 0;
      demo.stats.markers = 0;
      updateStats();
      log('ğŸ”„ æ¼”ç¤ºå·²é‡ç½®', 'info');
      updateInfo('æ¼”ç¤ºå·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹', 'info');
    };

    // æš´éœ²åˆ°å…¨å±€
    window.demo = demo;

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    init();
  </script>
</body>
</html>


